<div class="game-root">
  <header class="topbar">
    <div class="brand" (click)="onClickHome()">
      <span class="logo"></span>
      <span class="brand-text">{{ title }}</span>
    </div>

    <nav class="nav">
      <button class="link" (click)="onClickHome()">Home</button>
      <button class="link" (click)="openSettings()">Settings</button>
      <button class="btn restart" (click)="onClickRestart()">
        <span class="ico-refresh" aria-hidden="true"></span>
        Restart
      </button>
      <button
        class="btn pause"
        (click)="onClickPauseToggle()"
        [attr.aria-label]="paused ? 'Resume' : 'Pause'">
        <span [ngClass]="paused ? 'ico-play' : 'ico-pause'" aria-hidden="true"></span>
        {{ paused ? "Resume" : "Pause" }}
      </button>
    </nav>
  </header>


  <main class="play-wrap">
    <div class="play-layout">
      <aside class="score-side left" [class.only-score]="mode === 'classic'">
        <div class="stat">
          <div class="label">Score</div>
          <div class="value">{{ score }}</div>
        </div>

        <ng-container *ngIf="mode === 'speed'">
          <div class="stat">
            <div class="label small">Time</div>
            <div class="value small">{{ timeLeft }}s</div>
          </div>
          <div class="stat">
            <div class="label small">Speed</div>
            <div class="value small">{{ gameSpeed | number : "1.2-2" }}x</div>
          </div>
        </ng-container>

        <ng-container *ngIf="mode === 'challenge'">
          <div class="stat">
            <div class="label small">Time</div>
            <div class="value small">{{ timeLeft }}s</div>
          </div>
          <div class="stat">
            <div class="label small">Speed</div>
            <div class="value small">{{ gameSpeed | number : "1.2-2" }}x</div>
          </div>
        </ng-container>
      </aside>

      <app-game-classic
        *ngIf="mode === 'classic'"
        [mode]="mode"
        [paused]="paused"
        [gameSpeed]="gameSpeed"
        [classicSettings]="settings"
        [snakeSkin]="snakeSkin" 
        (scoreChange)="handleScoreChange($event)"
        (highScoreChange)="handleHighScoreChange($event)"
        (speedChange)="handleSpeedChange($event)"
        (gameOver)="handleGameOver()"
        (requestRestart)="handleRequestedRestart()"
        (resumeRequested)="handleResumeRequested()"
      ></app-game-classic>

      <app-game-speed
        *ngIf="mode === 'speed'"
        [mode]="mode"
        [paused]="paused"
        [gameSpeed]="gameSpeed"
        [speedSettings]="speedSettings"
        [snakeSkin]="snakeSkin" 
        (timeLeftChange)="handleTimeLeftChange($event)"
        (scoreChange)="handleScoreChange($event)"
        (highScoreChange)="handleHighScoreChange($event)"
        (speedChange)="handleSpeedChange($event)"
        (gameOver)="handleGameOver()"
        (requestRestart)="handleRequestedRestart()"
        (resumeRequested)="handleResumeRequested()"
      ></app-game-speed>

      <app-game-challenge
        *ngIf="mode === 'challenge'"
        [mode]="mode"
        [paused]="paused"
        [gameSpeed]="gameSpeed"
        [classicSettings]="settings"
        [timeLimitSec]="goals?.targetTime ?? null"
        [targetFruits]="goals?.targetFruits ?? null"
         [snakeSkin]="snakeSkin"
        (timeLeftChange)="handleTimeLeftChange($event)"
        (scoreChange)="handleScoreChange($event)"
        (highScoreChange)="handleHighScoreChange($event)"
        (speedChange)="handleSpeedChange($event)"
        (gameOver)="handleGameOver()"
        (requestRestart)="handleRequestedRestart()"
        (resumeRequested)="handleResumeRequested()"
      ></app-game-challenge>

      <aside class="score-side right">
        <ng-container *ngIf="mode === 'challenge'; else showHighScore">
          <div class="label">Fruits<br />Left</div>
          <div class="value">{{ fruitsRemaining ?? "—" }}</div>
        </ng-container>
        <ng-template #showHighScore>
          <div class="label">High<br />Score</div>
          <div class="value">{{ highScore }}</div>
        </ng-template>
      </aside>
    </div>
  </main>

  <footer class="bottombar">
    <div class="left">
      <span class="muted">Mode:</span>
      <span class="pill">{{ mode || "—" }}</span>

      <ng-container *ngIf="mode === 'speed'">
        <span class="sep" aria-hidden="true">&nbsp;•&nbsp;</span>
        <span class="muted">Obstacles:</span>
        <span class="pill">{{ speedSettings.obstaclesOn ? "On" : "Off" }}</span>
      </ng-container>

      <ng-container *ngIf="mode === 'challenge'">
        <span class="sep" aria-hidden="true">&nbsp;•&nbsp;</span>
        <span class="muted">Walls:</span>
        <span class="pill">{{ goals?.wallsAllowed ? "On" : "Off" }}</span>
      </ng-container>
    </div>
  </footer>

  <div
  class="modal-overlay"
  *ngIf="isSettingsOpen"
  (click)="onSettingsOverlayClick($event)"
>
  <div class="modal" role="dialog" aria-modal="true" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Settings</h3>
      <button class="modal-close" (click)="closeSettings()" aria-label="Close">✕</button>
    </div>

    <div class="modal-body">
      <app-settings
        [sfxEnabled]="sfxEnabledUi"
        [musicVolume]="musicVolumeUi"
        [snakeSkin]="snakeSkin"
        (sfxToggled)="onSettingsSfxToggled($event)"
        (musicVolumeChange)="onSettingsMusicChanged($event)"
        (snakeSkinChange)="onSnakeSkinChange($event)"
      ></app-settings>
    </div>
  </div>
</div>
</div>

<div class="game-root" [class.blurred]="showHowTo">
  <header class="topbar">
    <div class="brand" (click)="onClickHome()">
      <span class="logo"></span>
      <span class="brand-text">{{ title }}</span>
    </div>

    <nav class="nav">
      <button class="link" (click)="onClickHome()">Home</button>
      <button class="link" (click)="onClickHowTo()">How to Play</button>
      <span class="sep" aria-hidden="true">|</span>
      <button class="btn restart" (click)="onClickRestart()">
        <span class="ico-refresh" aria-hidden="true"></span>
        Restart
      </button>
      <button
        class="btn pause"
        (click)="onClickPauseToggle()"
        [attr.aria-label]="paused ? 'Resume' : 'Pause'"
      >
        <span
          [ngClass]="paused ? 'ico-play' : 'ico-pause'"
          aria-hidden="true"
        ></span>
        {{ paused ? "Resume" : "Pause" }}
      </button>
    </nav>
  </header>

  <main class="play-wrap">
    <div class="play-layout">
      <aside class="score-side left">
        <div class="label">Score</div>
        <div class="value">{{ score }}</div>

        <ng-container *ngIf="mode === 'speed'">
          <div class="label small">Time</div>
          <div class="value small">{{ timeLeft }}s</div>

          <div class="label small">Speed</div>
          <div class="value small">{{ gameSpeed | number : "1.2-2" }}x</div>
        </ng-container>
      </aside>

      <app-game-classic
        *ngIf="mode === 'classic'"
        [mode]="mode"
        [paused]="paused"
        [gameSpeed]="gameSpeed"
        [classicSettings]="settings"
        (scoreChange)="handleScoreChange($event)"
        (highScoreChange)="handleHighScoreChange($event)"
        (speedChange)="handleSpeedChange($event)"
        (gameOver)="handleGameOver()"
        (requestRestart)="handleRequestedRestart()"
        (resumeRequested)="handleResumeRequested()"
      ></app-game-classic>

      <app-game-speed
        *ngIf="mode === 'speed'"
        [mode]="mode"
        [paused]="paused"
        [gameSpeed]="gameSpeed"
        [speedSettings]="speedSettings"
        (timeLeftChange)="handleTimeLeftChange($event)"
        (scoreChange)="handleScoreChange($event)"
        (highScoreChange)="handleHighScoreChange($event)"
        (speedChange)="handleSpeedChange($event)"
        (gameOver)="handleGameOver()"
        (requestRestart)="handleRequestedRestart()"
        (resumeRequested)="handleResumeRequested()"
      ></app-game-speed>

      <aside class="score-side right">
        <div class="label">High<br />Score</div>
        <div class="value">{{ highScore }}</div>
      </aside>
    </div>
  </main>

  <footer class="bottombar">
    <div class="left">
      <span class="muted">Mode:</span>
      <span class="pill">{{ mode || "—" }}</span>

      <ng-container *ngIf="mode === 'speed'">
        <span class="sep" aria-hidden="true">&nbsp;•&nbsp;</span>
        <span class="muted">Obstacles:</span>
        <span class="pill">{{ speedSettings.obstaclesOn ? "On" : "Off" }}</span>
      </ng-container>
    </div>
  </footer>
</div>

<div *ngIf="showHowTo" class="modal-wrap" role="dialog" aria-modal="true">
  <div class="modal-backdrop" (click)="closeHowTo()"></div>
  <div class="modal-panel" tabindex="-1">
    <header class="modal-header">
      <h3>How to Play</h3>
      <button class="modal-close" (click)="closeHowTo()" aria-label="Close">
        ×
      </button>
    </header>
    <div class="modal-body">
      <app-how-to-play></app-how-to-play>
    </div>
  </div>
</div>
